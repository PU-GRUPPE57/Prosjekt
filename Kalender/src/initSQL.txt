create DATABASE TEST2;
USE TEST2;

CREATE TABLE `Bruker` (
  `BrukerID` INT UNSIGNED NOT NULL,
  `Fornavn` VARCHAR(45) NOT NULL,
  `Etternavn` VARCHAR(45) NOT NULL,
  `IsAdmin` INT NOT NULL,
  
  `Brukernavn` VARCHAR(45) NOT NULL UNIQUE,
  `Passord`	VARCHAR(45) NOT NULL,
  
  PRIMARY KEY (`BrukerID`)
  );
  
CREATE TABLE `Gruppe` (
  `GruppeID` INT UNSIGNED NOT NULL,
  `Navn` VARCHAR(45) NOT NULL,
  `Admin` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`GruppeID`),
  FOREIGN KEY (`Admin`) REFERENCES BRUKER(`BRUKERID`)
  		ON DELETE CASCADE ON UPDATE CASCADE
  );

CREATE TABLE `BrukerIgruppe` (
	`GruppeID` INT UNSIGNED NOT NULL,
	`BrukerID` INT UNSIGNED NOT NULL,
    
	PRIMARY KEY (`GruppeID`,`BrukerID`),
	FOREIGN KEY (`BrukerID`) REFERENCES Bruker(`BrukerID`)
		ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (`GruppeID`) REFERENCES Gruppe(`GruppeID`)
		ON DELETE CASCADE ON UPDATE CASCADE
 );

CREATE TABLE `Rom`(
 	`RomID` INT UNSIGNED NOT NULL,
 	`Size` INT UNSIGNED NOT NULL,
 	`Navn` VARCHAR(45) UNIQUE,
 	`Type` VARCHAR(45),
 	PRIMARY KEY (`RomID`)
 );

CREATE TABLE `Avtale` (
  `AvtaleID` INT UNSIGNED NOT NULL,
  `Name` VARCHAR(45) NOT NULL,
  `Start` DATETIME NOT NULL,		
  `Slutt` DATETIME NOT NULL,
  `Beskrivelse` VARCHAR(45),
  
  `Prioritet` INT(1),
  `BrukerID` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`AvtaleID`),
  FOREIGN KEY (`BrukerID`) REFERENCES Bruker(`BrukerID`)
  		ON DELETE CASCADE ON UPDATE CASCADE
  );
  
  
CREATE TABLE `BrukerIAvtale` (
	`AvtaleID` INT UNSIGNED NOT NULL,
	`BrukerID` INT UNSIGNED NOT NULL,
	`Status` INT UNSIGNED NOT NULL,
	`Synlighet` INT NOT NULL,
	
    
	PRIMARY KEY (`BrukerID`,`AvtaleID`),
	FOREIGN KEY (`BrukerID`) REFERENCES Bruker(`BrukerID`)
		ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (`AvtaleID`) REFERENCES Avtale(`AvtaleID`)
		ON DELETE CASCADE ON UPDATE CASCADE
 );
 
 	
CREATE TABLE `Varsel` (
	`VarselID` INT UNSIGNED NOT NULL,
	`AvtaleID` INT UNSIGNED,
	`GruppeID` INT UNSIGNED,
	`Brukersomvarsler` INT UNSIGNED,
	`Melding` VARCHAR(256),
	`Meldingstype` INT UNSIGNED NOT NULL,
	
	PRIMARY KEY (`VarselID`),
	FOREIGN KEY (`AvtaleID`) REFERENCES Avtale(`AvtaleID`)
			ON DELETE CASCADE,
	FOREIGN KEY (`GruppeID`) REFERENCES Gruppe(`GruppeID`)
			ON DELETE CASCADE,
	FOREIGN KEY (`Brukersomvarsler`) REFERENCES Bruker(`BrukerID`)
			ON DELETE CASCADE
	);
    
    
CREATE TABLE `BrukerHarVarsel` (
	`BrukerID` INT UNSIGNED NOT NULL,
	`VarselID` INT UNSIGNED NOT NULL,
    
	PRIMARY KEY (`BrukerID`,`VarselID`),
	FOREIGN KEY (`BrukerID`) REFERENCES Bruker(`BrukerID`)
		ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (`VarselID`) REFERENCES Varsel(`VarselID`)
		ON DELETE CASCADE ON UPDATE CASCADE
 ); 
 
 
 CREATE TABLE `romRes`(
	`RomID` INT UNSIGNED NOT NULL,
    `Start` DATETIME NOT NULL,		
	`Slutt` DATETIME NOT NULL,
    `AvtaleID` INT UNSIGNED NOT NULL,
	PRIMARY KEY (`RomID`, `Start`, `Slutt`),
    FOREIGN KEY (`RomID`) REFERENCES Rom(`RomID`)
    		ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (`AvtaleID`) REFERENCES Avtale(`AvtaleID`)
			ON DELETE CASCADE ON UPDATE CASCADE		
    );
 